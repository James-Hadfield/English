<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TSA Speaking: Unit 3</title>
    <style>
        :root {
            --primary: #4A90E2; /* Bright Blue */
            --secondary: #50E3C2; /* Teal */
            --accent: #F5A623; /* Orange */
            --text: #2C3E50;
            --bg: #F0F4F8;
            --white: #ffffff;
            --success: #7ED321;
            --danger: #E05d5d;
            --card-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        body {
            font-family: 'Comic Sans MS', 'Chalkboard SE', 'Segoe UI', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg);
            color: var(--text);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- Header --- */
        header {
            background: linear-gradient(90deg, var(--primary), #357ABD);
            color: var(--white);
            padding: 10px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            z-index: 100;
        }

        h1 { margin: 0; font-size: 1.5rem; letter-spacing: 1px; }
        
        .header-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .slide-counter { font-size: 1rem; font-weight: bold; background: rgba(255,255,255,0.2); padding: 5px 15px; border-radius: 20px; }

        /* --- Main Content --- */
        main {
            flex: 1;
            position: relative;
            width: 100%;
            height: 100%;
            overflow-y: auto;
            background-image: radial-gradient(#e1e8ed 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .slide {
            display: none;
            width: 100%;
            min-height: 100%;
            padding: 20px;
            box-sizing: border-box;
            animation: fadeIn 0.4s ease-out;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .slide.active {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.98); }
            to { opacity: 1; transform: scale(1); }
        }

        /* --- Full Screen Card Style --- */
        .content-card {
            background: var(--white);
            width: 95%;
            max-width: 1400px;
            height: 90%;
            border-radius: 20px;
            box-shadow: var(--card-shadow);
            padding: 40px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            border: 4px solid var(--primary);
        }

        h2 { 
            color: var(--primary); 
            font-size: 2.5rem; 
            margin-top: 0; 
            text-align: center;
            border-bottom: 3px dashed #ddd;
            padding-bottom: 15px;
        }
        
        p, li { font-size: 1.3rem; line-height: 1.6; }

        /* --- Badges --- */
        .badge {
            display: inline-block;
            padding: 8px 15px;
            border-radius: 50px;
            color: white;
            font-weight: bold;
            font-size: 1rem;
            margin: 5px;
            text-transform: uppercase;
        }
        .badge-teacher { background: var(--secondary); color: #006b5f; }
        .badge-speak { background: var(--accent); }
        .badge-video { background: #E91E63; color: white; }

        /* --- Grid & Cards --- */
        .grid-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
            width: 100%;
        }

        .option-card {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100px;
        }
        .option-card:hover { transform: translateY(-5px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); border-color: var(--primary); }
        .option-card.correct { background: #d4edda; border-color: var(--success); color: #155724; }
        .option-card.incorrect { background: #f8d7da; border-color: var(--danger); color: #721c24; }

        /* --- Video Analysis Styles --- */
        .video-selector-container {
            width: 100%;
            max-width: 600px;
            margin: 0 auto 30px auto;
            text-align: center;
        }

        select#video-select {
            width: 100%;
            padding: 15px;
            font-size: 1.2rem;
            border-radius: 10px;
            border: 2px solid var(--primary);
            background-color: #fff;
            cursor: pointer;
        }

        .video-content-area {
            background: #fafafa;
            border-radius: 15px;
            padding: 20px;
            border: 1px solid #eee;
            margin-top: 20px;
        }

        .question-block {
            background: #fff;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border-left: 5px solid var(--accent);
        }

        .btn-vid-opt {
            margin: 5px;
            padding: 8px 16px;
            border: 1px solid #ccc;
            background: #f0f0f0;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s;
        }
        .btn-vid-opt:hover { background: #e0e0e0; }
        
        .feedback-box {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
            display: none;
        }
        .feedback-box.show { display: block; animation: fadeIn 0.3s; }
        .feedback-box.correct { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .feedback-box.wrong { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }

        /* --- Format Visuals --- */
        .format-box {
            flex: 1;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .format-prep { background: #5D9CEC; }
        .format-speak { background: #FFCE54; color: #8a6d3b; }
        .big-icon { font-size: 4rem; margin-bottom: 10px; display: block; }
        .big-number { font-size: 5rem; font-weight: 800; line-height: 1; }

        /* --- Stages Drag & Drop --- */
        .path-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
        }
        .draggable-item {
            /* Default background removed, set by inline style for color */
            border: 3px solid #333;
            border-radius: 15px;
            padding: 10px 30px;
            font-size: 1.2rem;
            cursor: grab;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            user-select: none;
            text-align: center;
            color: white; /* White text for colored boxes */
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        .draggable-item span.stem-preview {
            font-size: 0.9rem;
            color: #eee;
            font-style: italic;
            margin-top: 5px;
            background: rgba(0,0,0,0.2);
            padding: 2px 8px;
            border-radius: 10px;
        }
        .draggable-item:active { cursor: grabbing; }
        .draggable-item.dragging { opacity: 0.5; transform: scale(0.98); }
        /* Colors for each item handled in JS */
        
        .draggable-item.correct { border: 5px solid #2ecc71 !important; box-shadow: 0 0 10px #2ecc71; }
        .draggable-item.wrong { border: 5px solid #e74c3c !important; opacity: 0.8; }

        .check-btn {
            background: var(--primary);
            color: white;
            padding: 15px 30px;
            font-size: 1.5rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            margin-top: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            transition: transform 0.1s;
        }
        .check-btn:hover { background: #357ABD; transform: translateY(-2px); }
        
        .reset-btn {
            background: #95a5a6;
            color: white;
            padding: 10px 20px;
            font-size: 1.2rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            margin-top: 20px;
            margin-left: 10px;
        }

        /* --- Brainstorming --- */
        .task-card {
            background: #FFF8E1;
            border: 3px solid #FFECB3;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .task-list { text-align: left; background: white; padding: 15px; border-radius: 10px; border: 1px dashed #ccc; }
        
        .timer-display {
            font-size: 3rem;
            font-family: monospace;
            background: #333;
            color: #0f0;
            padding: 10px 30px;
            border-radius: 10px;
            display: inline-block;
            margin: 10px 0;
        }

        /* --- Modal for Christmas Ball --- */
        .modal {
            display: none; 
            position: fixed; 
            z-index: 200; 
            left: 0;
            top: 0;
            width: 100%; 
            height: 100%; 
            overflow: auto; 
            background-color: rgba(0,0,0,0.4); 
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background-color: #fefefe;
            margin: 10% auto; 
            padding: 20px;
            border: 1px solid #888;
            width: 80%; 
            border-radius: 15px;
            box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
        }

        .close-modal {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close-modal:hover { color: black; }

        /* --- Footer --- */
        footer {
            background: var(--white);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            border-top: 2px solid #eee;
        }

        .btn {
            padding: 12px 30px;
            font-size: 1.2rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.1s;
        }
        .btn:active { transform: translateY(2px); }
        .btn-nav { background-color: var(--primary); color: white; }
        .btn-nav:disabled { background-color: #ccc; cursor: not-allowed; transform: none; box-shadow: none; }
        .btn-action { background-color: var(--accent); color: white; }
        .btn-help { background-color: var(--success); color: white; }
        .btn-video-top { background-color: #E91E63; color: white; border-radius: 20px; padding: 8px 20px; font-size: 1rem; box-shadow: 0 2px 5px rgba(0,0,0,0.2); margin-left: 10px;}
        .btn-video-top:hover { background-color: #C2185B; }
        .btn-info-top { background-color: #9C27B0; color: white; border-radius: 20px; padding: 8px 20px; font-size: 1rem; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .btn-info-top:hover { background-color: #7B1FA2; }


        /* --- Transition --- */
        .transition-text {
            font-size: 4rem;
            color: white;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .transition-bg {
            background: var(--primary);
            color: white;
            justify-content: center;
            align-items: center;
        }
        
        .stem-box {
            background: #E8EAF6; 
            padding: 10px; 
            border-radius: 5px; 
            border-left: 4px solid #3F51B5;
            margin-bottom: 10px;
            text-align: left;
            font-size: 1.1rem;
        }
        
        /* Game Styles */
        .game-score-box {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .score-control-btn {
            width: 30px; height: 30px;
            border-radius: 50%;
            border: none;
            background: #ccc;
            font-weight: bold;
            cursor: pointer;
        }
        .score-control-btn:hover { background: #bbb; }
        
        .game-option {
            background: white;
            border: 3px solid var(--accent);
            padding: 20px;
            font-size: 1.5rem;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.2s;
        }
        .game-option:hover { transform: scale(1.02); background: #FFF3E0; }
        
        #team-selector {
            padding: 10px;
            font-size: 1.2rem;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        #game-timer {
            font-size: 1.5rem;
            font-weight: bold;
            color: #d35400;
            margin-top: 10px;
        }
        
        /* Winner Confetti & Trophy */
        @keyframes confetti-fall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }
        .confetti {
            position: fixed;
            top: 0;
            width: 10px; height: 10px;
            background: red;
            z-index: 999;
            animation: confetti-fall 3s linear infinite;
        }
        .trophy-container {
            font-size: 5rem;
            animation: bounce 1s infinite;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

    </style>
</head>
<body>

<header>
    <h1>üê∂ Unit 3: Animal Friends</h1>
    <div class="header-controls">
        <button class="btn btn-info-top" onclick="openModal()">üéÑ Christmas Ball Task</button>
        <button class="btn btn-video-top" onclick="jumpToVideoSlide()">üé¨ Video Analysis</button>
        <div class="slide-counter">Page <span id="current-slide-num">1</span> / 11</div>
    </div>
</header>

<main id="app">

    <!-- SLIDE 1: Title -->
    <div class="slide active" id="slide-1" style="background: #e3f2fd;">
        <div style="text-align: center;">
            <div style="font-size: 6rem; margin-bottom: 20px;">üó£Ô∏è</div>
            <h1 style="font-size: 4rem; color: var(--primary); margin: 0;">Planning the Best Party Ever!</h1>
            <h2 style="font-size: 2rem; border: none; color: #666;">TSA Group Interaction (Pages 13 & 14)</h2>
            <div style="margin-top: 40px; font-size: 1.5rem; background: white; padding: 20px; border-radius: 20px; display: inline-block;">
                Today's Goal: <br>
                <strong>Learn the Exam Rules</strong> & <strong>Discuss a Plan</strong>
            </div>
        </div>
    </div>

    <!-- SLIDE 2: Warmer -->
    <div class="slide" id="slide-2">
        <div class="content-card">
            <div style="text-align: center;">
                <span class="badge badge-teacher">Warm Up</span>
                <span class="badge badge-speak">Pair Work</span>
            </div>
            <h2>üëç Good or üëé Bad?</h2>
            <p style="text-align: center; background: #FFF3E0; padding: 15px; border-radius: 10px;">
                <strong>Talk to your partner first!</strong><br>
                Is this good or bad when working in a group? Click to check.
            </p>
            
            <div class="grid-options">
                <div class="option-card" onclick="checkWarmer(this, true)">üëÇ Listening carefully to others</div>
                <div class="option-card" onclick="checkWarmer(this, false)">üìÑ Looking only at your paper</div>
                <div class="option-card" onclick="checkWarmer(this, true)">‚ùì Asking "Why?"</div>
                <div class="option-card" onclick="checkWarmer(this, false)">üì¢ Talking too much</div>
                <div class="option-card" onclick="checkWarmer(this, true)">ü§ù Asking quiet people to share</div>
                <div class="option-card" onclick="checkWarmer(this, false)">ü§ê Saying nothing</div>
            </div>
        </div>
    </div>

    <!-- SLIDE 3: Transition -->
    <div class="slide transition-bg" id="slide-3">
        <div class="transition-text">
            <div>üìñ Open Page 13</div>
            <div style="font-size: 2rem; margin-top: 20px; opacity: 0.9;">The Exam Rules</div>
        </div>
    </div>

    <!-- SLIDE 4: Instruction (Format) -->
    <div class="slide" id="slide-4">
        <div class="content-card">
            <span class="badge badge-teacher">Important Rules</span>
            <h2>TSA Exam Format</h2>
            <div style="display: flex; gap: 30px; height: 100%; flex-wrap: wrap;">
                
                <div class="format-box format-prep">
                    <span class="big-icon">üìù</span>
                    <h3>Prep Time</h3>
                    <span class="big-number">3</span>
                    <p>Minutes</p>
                    <div style="background: rgba(0,0,0,0.1); padding: 15px; border-radius: 10px; margin-top: 20px; text-align: left;">
                        ‚úÖ Read the paper<br>
                        ‚úÖ Write notes<br>
                        ‚ùå <strong>NO TALKING</strong>
                    </div>
                </div>

                <div class="format-box format-speak">
                    <span class="big-icon">üí¨</span>
                    <h3>Discussion</h3>
                    <span class="big-number">4</span>
                    <p>Minutes</p>
                    <div style="background: rgba(0,0,0,0.1); padding: 15px; border-radius: 10px; margin-top: 20px; text-align: left;">
                        ‚úÖ Talk together<br>
                        ‚úÖ Look at friends (Eye Contact)<br>
                        ‚ùå Don't just read notes!
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- SLIDE 5: Role Check -->
    <div class="slide" id="slide-5">
        <div class="content-card">
            <div style="text-align: center;">
                <span class="badge badge-teacher">Page 13 Question (ii)</span>
                <span class="badge badge-speak">Understand Your Role</span>
            </div>
            <h2>What do you need to do? üéÑ</h2>
            <p style="text-align: center;">Look at Question (ii) on Page 13. What is your job?</p>
            
            <div class="grid-options" style="max-width: 800px; margin: 0 auto;">
                <div class="option-card" onclick="checkRole(this, false)">
                    <span style="font-size: 2rem; margin-right: 15px;">üéæ</span> 
                    Play tennis
                </div>
                <div class="option-card" onclick="checkRole(this, true)">
                    <span style="font-size: 2rem; margin-right: 15px;">üìã</span> 
                    Plan a Christmas ball
                </div>
                <div class="option-card" onclick="checkRole(this, false)">
                    <span style="font-size: 2rem; margin-right: 15px;">üéÅ</span> 
                    Buy gifts for teachers
                </div>
            </div>
            <p id="role-feedback" style="text-align: center; font-size: 1.5rem; font-weight: bold; margin-top: 20px;"></p>
        </div>
    </div>

    <!-- SLIDE 6: Definition Check -->
    <div class="slide" id="slide-6">
        <div class="content-card">
            <div style="text-align: center;">
                <span class="badge badge-teacher">Page 13 Question (iii)</span>
                <span class="badge badge-speak">Check with Partner</span>
            </div>
            <h2>What is a "Ball"? üíÉüï∫</h2>
            <p style="text-align: center;">Look at Question (iii) on Page 13. Which one is correct for "Christmas Ball"?</p>
            
            <div class="grid-options" style="max-width: 800px; margin: 0 auto;">
                <div class="option-card" onclick="checkDefinition(this, false)">
                    <span style="font-size: 2rem; margin-right: 15px;">üèÄ</span> 
                    A sport game (Tennis, Basketball)
                </div>
                <div class="option-card" onclick="checkDefinition(this, false)">
                    <span style="font-size: 2rem; margin-right: 15px;">üéÇ</span> 
                    A normal birthday party
                </div>
                <div class="option-card" onclick="checkDefinition(this, true)">
                    <span style="font-size: 2rem; margin-right: 15px;">üëó</span> 
                    A big, fancy party
                </div>
            </div>
            <p id="def-feedback" style="text-align: center; font-size: 1.5rem; font-weight: bold; margin-top: 20px;"></p>
        </div>
    </div>

    <!-- SLIDE 7: The 6 Stages (Colorful & Previews) -->
    <div class="slide" id="slide-7">
        <div class="content-card">
            <span class="badge badge-teacher">Discussion Flow (Page 14)</span>
            <h2>Order the Steps (1 to 6)</h2>
            <p style="text-align: center;">Drag the colored boxes to the correct order!</p>
            
            <div class="path-container" id="draggable-list">
                <!-- Items injected by JS with specific colors -->
            </div>
            
            <div style="text-align: center;">
                <button class="check-btn" onclick="checkOrder()">‚úÖ Check Answer</button>
                <button class="reset-btn" onclick="initDragAndDrop()">üîÑ Reset</button>
            </div>
        </div>
    </div>

    <!-- SLIDE 8: VIDEO ANALYSIS (Updated Logistics Questions) -->
    <div class="slide" id="slide-8">
        <div class="content-card">
            <span class="badge badge-video">Video Model</span>
            <h2>üëÄ Concept Check</h2>
            <p style="text-align:center;">Watch the students (Group 6). Observe the rules they follow.</p>
            
            <div class="video-selector-container">
                <label for="video-select" style="display:block; margin-bottom:10px; font-weight:bold;">Video:</label>
                <select id="video-select" onchange="loadVideoContent()">
                    <option value="group6">Video 1: Students Discussing (Group 6)</option>
                </select>
            </div>

            <div id="video-content" class="video-content-area">
                <!-- Dynamic Content Loaded Here -->
            </div>
        </div>
    </div>

    <!-- SLIDE 9: Mini-Group Discussion (TSA Format) -->
    <div class="slide" id="slide-9">
        <div class="content-card">
            <span class="badge badge-speak">Final Task</span>
            <h2>üí¨ Mini-Group Discussion</h2>
            <p>Get into groups of 3 or 4. Your TSA Prompt:</p>
            
            <div style="text-align: center; margin: 20px 0;">
                <div id="random-topic-box" style="background: #FFEB3B; padding: 20px; border-radius: 15px; border: 4px solid #FBC02D; min-height: 200px; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                    <div style="font-size: 2rem; font-weight: bold;">‚ùì Click to Spin Topic</div>
                </div>
                <button class="btn btn-action" onclick="spinTopic()" style="margin-top: 15px;">üîÑ New Topic</button>
            </div>

            <div style="display: flex; justify-content: space-around; background: #eee; padding: 20px; border-radius: 10px;">
                <div style="text-align: center;">
                    <h3>Step 1: Plan</h3>
                    <div class="timer-display" id="prep-timer">03:00</div>
                    <br>
                    <button class="btn btn-nav" onclick="startSimpleTimer(180, 'prep-timer')">Start Prep</button>
                </div>
                <div style="text-align: center;">
                    <h3>Step 2: Discuss</h3>
                    <div class="timer-display" id="discuss-timer">04:00</div>
                    <br>
                    <button class="btn btn-action" onclick="startSimpleTimer(240, 'discuss-timer')">Start Talk</button>
                </div>
            </div>
        </div>
    </div>

    <!-- SLIDE 10: Review Quiz -->
    <div class="slide" id="slide-10">
        <div class="content-card">
            <span class="badge badge-teacher">Quiz</span>
            <h2>üèÜ Class Quiz</h2>
            <p style="text-align: center;">Click the right answer!</p>
            
            <div id="quiz-area" style="text-align: center; max-width: 800px; margin: 0 auto;">
                <div id="quiz-question" style="font-size: 2rem; font-weight: bold; margin-bottom: 30px;">Loading...</div>
                <div id="quiz-options" class="grid-options"></div>
                <div id="quiz-feedback" style="margin-top: 30px; font-size: 1.5rem; font-weight: bold;"></div>
                <div style="margin-top: 30px;">
                    <button class="btn btn-nav" onclick="nextQuestion()" id="btn-next-q" style="display:none;">Next Question ‚û°Ô∏è</button>
                </div>
            </div>
        </div>
    </div>

    <!-- SLIDE 11: Team Game (Updated Controls & Questions) -->
    <div class="slide" id="slide-11">
        <div class="content-card">
            <span class="badge badge-speak">Class Game</span>
            <h2>üî• Sentence Starter Relay</h2>
            
            <div style="text-align: center; margin-bottom: 20px;">
                <label style="font-size: 1.2rem; font-weight: bold;">Playing Now:</label>
                <select id="team-selector" onchange="updateCurrentTurn()">
                    <option value="A">Team A</option>
                    <option value="B">Team B</option>
                </select>
                <div id="game-timer">15s</div>
            </div>
            
            <div style="display: flex; justify-content: space-between; margin-bottom: 20px; align-items: center;">
                <div class="game-score-box">
                    Team A: <span id="score-a">0</span>
                    <button class="score-control-btn" onclick="adjustScore('A', 1)">+</button>
                    <button class="score-control-btn" onclick="adjustScore('A', -1)">-</button>
                </div>
                <div class="game-score-box" style="color: var(--danger);">
                    Team B: <span id="score-b">0</span>
                    <button class="score-control-btn" onclick="adjustScore('B', 1)">+</button>
                    <button class="score-control-btn" onclick="adjustScore('B', -1)">-</button>
                </div>
            </div>

            <div id="game-area" style="text-align: center;">
                <h3 id="game-prompt" style="font-size: 2rem; margin-bottom: 30px;">Loading...</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="game-option" onclick="checkGameAnswer(0)">Option 1</div>
                    <div class="game-option" onclick="checkGameAnswer(1)">Option 2</div>
                </div>
                <div id="game-feedback" style="margin-top: 20px; font-weight: bold; font-size: 1.5rem;"></div>
                
                <div style="margin-top: 20px;">
                    <button class="btn btn-nav" onclick="nextGameRound()">Next Round ‚û°Ô∏è</button>
                </div>
                <div style="margin-top: 40px; border-top: 1px solid #ccc; padding-top: 20px;">
                    <button class="btn btn-action" onclick="endGame()">üèÜ Finish Game</button>
                    <button class="btn btn-nav" onclick="resetGame()" style="background:#95a5a6;">üîÑ Restart Game</button>
                </div>
            </div>
        </div>
    </div>

</main>

<footer>
    <button class="btn btn-nav" id="prev-btn" onclick="changeSlide(-1)">‚¨ÖÔ∏è Back</button>
    <button class="btn btn-nav" id="next-btn" onclick="changeSlide(1)">Next ‚û°Ô∏è</button>
</footer>

<!-- Modal Content for Christmas Ball -->
<div id="myModal" class="modal">
  <div class="modal-content">
    <span class="close-modal" onclick="closeModal()">&times;</span>
    <h2 style="color: var(--primary);">üéÑ The Christmas Ball Task</h2>
    <div style="font-size: 1.2rem; line-height: 1.8;">
        <p><strong>Situation:</strong> You and other members of the Student Union are planning to hold a Christmas Ball.</p>
        <p><strong>In your discussion, you may talk about:</strong></p>
        <ul>
            <li>üìÖ Date, time and venue</li>
            <li>üë• Participants (Who can come?)</li>
            <li>üí∞ Entry fee (How much?)</li>
            <li>ü•™ Refreshment (Food/Drink)</li>
            <li>üëó Dress code</li>
            <li>üéÆ Games/programmes</li>
        </ul>
    </div>
  </div>
</div>

<script>
    /* --- State Management --- */
    let currentSlide = 1;
    const totalSlides = 11;
    let timerInterval;

    /* --- Quiz Data --- */
    const quizQuestions = [
        { q: "Today's class is about...", options: ["Group Interactions", "Individual Presentations", "Speaking Contests"], ans: 0 },
        { q: "Preparation time is...", options: ["2 Minutes", "3 Minutes", "4 Minutes"], ans: 1 },
        { q: "Discussion time is...", options: ["3 Minutes", "4 Minutes", "5 Minutes"], ans: 1 },
        { q: "In the discussion, you should...", options: ["Look at the floor", "Read your notes", "Look at friends"], ans: 2 },
        { q: "A 'Ball' is...", options: ["A sport game", "A casual party", "A fancy party"], ans: 2 }
    ];
    let quizIndex = 0;

    /* --- Random Topics for Mini-Group (Updated TSA Format with 3 Points) --- */
    const randomTopics = [
        { title: "Plan a Class Picnic üß∫", points: ["1. Where to go?", "2. Food to bring", "3. Games to play"] },
        { title: "Plan a Sports Day üèÖ", points: ["1. When to hold it?", "2. What sports events?", "3. Prizes for winners"] },
        { title: "Plan a Singing Contest üé§", points: ["1. Who can join?", "2. The Judges", "3. The Songs"] },
        { title: "Plan a Charity Fair ‚ù§Ô∏è", points: ["1. What to sell?", "2. Which charity?", "3. Who will help?"] },
        { title: "Plan a Halloween Party üéÉ", points: ["1. Costumes", "2. Decoration", "3. Scary Food"] }
    ];

    /* --- Game Data (Expanded to 12 Questions) --- */
    const gameQuestions = [
        { text: "\"We're here today to talk about...\"", options: ["Starting", "Suggesting"], ans: 0 },
        { text: "\"I think we could...\"", options: ["Starting", "Suggesting"], ans: 1 },
        { text: "\"How about...?\"", options: ["Suggesting", "Closing"], ans: 0 },
        { text: "\"Shut up!\"", options: ["Polite", "Rude"], ans: 1 },
        { text: "\"I'm sorry, I disagree.\"", options: ["Polite", "Rude"], ans: 0 },
        { text: "\"Let's start!\"", options: ["Starting", "Responding"], ans: 0 },
        { text: "\"That's a great idea!\"", options: ["Responding", "Starting"], ans: 0 },
        { text: "\"What do you think?\"", options: ["Encouraging", "Closing"], ans: 0 },
        { text: "\"I suggest we...\"", options: ["Suggesting", "Closing"], ans: 0 },
        { text: "\"You are wrong!\"", options: ["Polite", "Rude"], ans: 1 },
        { text: "\"To sum up...\"", options: ["Closing", "Opening"], ans: 0 },
        { text: "\"Shall we move on?\"", options: ["Transitioning", "Opening"], ans: 0 }
    ];
    let gameIndex = 0;
    let scoreA = 0;
    let scoreB = 0;
    let currentTurn = 'A';
    let gameTimerInterval;

    /* --- Video Content Data (Reverted to Logistics) --- */
    const videoData = {
        group6: {
            title: "Concept Check: Logistics",
            questions: [
                {
                    text: "How long is the discussion?",
                    options: ["10 Minutes", "4 Minutes (Group of 3)", "1 Hour"],
                    correct: 1,
                    explanation: "Correct! The key says 4 minutes for 3 members (or 5 mins for 4 members)."
                },
                {
                    text: "Who speaks in the video?",
                    options: ["Students and Teachers", "Only Students", "Only Teachers"],
                    correct: 1,
                    explanation: "Correct! The teacher (examiner) listens but does not speak."
                },
                {
                    text: "How many students are usually in a group?",
                    options: ["1 or 2", "3 or 4", "10"],
                    correct: 1,
                    explanation: "Correct! A group interaction usually has 3 or 4 students."
                }
            ]
        }
    };

    /* --- Navigation --- */
    function changeSlide(direction) {
        document.getElementById(`slide-${currentSlide}`).classList.remove('active');
        currentSlide += direction;
        if (currentSlide < 1) currentSlide = 1;
        if (currentSlide > totalSlides) currentSlide = totalSlides;
        document.getElementById(`slide-${currentSlide}`).classList.add('active');
        document.getElementById('current-slide-num').innerText = currentSlide;
        document.getElementById('prev-btn').disabled = (currentSlide === 1);
        document.getElementById('next-btn').disabled = (currentSlide === totalSlides);
        
        if(currentSlide === 10 && quizIndex === 0) loadQuestion();
        if(currentSlide === 11 && gameIndex === 0) {
            loadGameQuestion();
            resetGameTimer(); // Auto start timer on load? Or wait for first action? Let's start it.
        }
        
        // Init Drag & Drop when entering Slide 7
        if(currentSlide === 7 && !isDragInitialized) {
            initDragAndDrop();
        }

        // Init Video when entering Slide 8
        if(currentSlide === 8) {
            loadVideoContent();
        }
    }

    function jumpToVideoSlide() {
        document.getElementById(`slide-${currentSlide}`).classList.remove('active');
        currentSlide = 8; 
        document.getElementById(`slide-8`).classList.add('active');
        document.getElementById('current-slide-num').innerText = 8;
        document.getElementById('prev-btn').disabled = false;
        document.getElementById('next-btn').disabled = false;
        loadVideoContent();
    }

    /* --- Modal Logic --- */
    function openModal() {
        document.getElementById("myModal").style.display = "block";
    }
    function closeModal() {
        document.getElementById("myModal").style.display = "none";
    }
    window.onclick = function(event) {
        if (event.target == document.getElementById("myModal")) {
            closeModal();
        }
    }

    /* --- Interactive Functions --- */
    function checkWarmer(el, isCorrect) {
        if (isCorrect) {
            el.classList.add('correct');
            el.innerHTML += " ‚úÖ";
        } else {
            el.classList.add('incorrect');
            el.innerHTML += " ‚ùå";
        }
        el.onclick = null;
    }

    function checkRole(el, isCorrect) {
        const allOpts = el.parentElement.querySelectorAll('.option-card');
        allOpts.forEach(opt => {
            opt.classList.remove('correct', 'incorrect');
        });

        if(isCorrect) {
            el.classList.add('correct');
            document.getElementById('role-feedback').innerText = "Correct! You are the Student Union planning a ball. üìã";
            document.getElementById('role-feedback').style.color = "var(--success)";
        } else {
            el.classList.add('incorrect');
            document.getElementById('role-feedback').innerText = "Try again! ‚ùå";
            document.getElementById('role-feedback').style.color = "var(--danger)";
        }
    }

    function checkDefinition(el, isCorrect) {
        const allOpts = el.parentElement.querySelectorAll('.option-card');
        allOpts.forEach(opt => {
            opt.classList.remove('correct', 'incorrect');
        });

        if(isCorrect) {
            el.classList.add('correct');
            document.getElementById('def-feedback').innerText = "Correct! It is a fancy event. ‚ú®";
            document.getElementById('def-feedback').style.color = "var(--success)";
        } else {
            el.classList.add('incorrect');
            document.getElementById('def-feedback').innerText = "Try again! ‚ùå";
            document.getElementById('def-feedback').style.color = "var(--danger)";
        }
    }

    /* --- Video Logic --- */
    function loadVideoContent() {
        const select = document.getElementById('video-select');
        const container = document.getElementById('video-content');
        const data = videoData[select.value];

        let html = `<h3>${data.title}</h3>`;
        
        data.questions.forEach((q, qIndex) => {
            html += `<div class="question-block">
                <p><strong>${qIndex + 1}. ${q.text}</strong></p>
                <div>`;
            
            q.options.forEach((opt, oIndex) => {
                html += `<button class="btn-vid-opt" onclick="checkVideoAnswer(this, '${select.value}', ${qIndex}, ${oIndex})">${opt}</button> `;
            });

            html += `</div>
                <div id="vid-feedback-${qIndex}" class="feedback-box"></div>
            </div>`;
        });
        container.innerHTML = html;
    }

    function checkVideoAnswer(btn, videoKey, qIndex, oIndex) {
        const data = videoData[videoKey].questions[qIndex];
        const feedbackBox = document.getElementById(`vid-feedback-${qIndex}`);
        
        const siblings = btn.parentElement.children;
        for(let sib of siblings) {
            sib.style.background = "#f0f0f0";
            sib.style.color = "black";
        }

        if (oIndex === data.correct) {
            btn.style.background = "var(--success)";
            btn.style.color = "white";
            feedbackBox.className = "feedback-box show correct";
            feedbackBox.innerText = data.explanation;
        } else {
            btn.style.background = "var(--danger)";
            btn.style.color = "white";
            feedbackBox.className = "feedback-box show wrong";
            feedbackBox.innerText = "Incorrect. Try again.";
        }
    }

    /* --- Drag & Drop Logic (Colorful Boxes) --- */
    const correctStages = [
        { text: "Open the discussion", preview: "üëã 'Hi everyone! We are here to talk about...'", color: "#3498db" },
        { text: "Give suggestions", preview: "üí° 'I think we should...' / 'I suggest...'", color: "#2ecc71" },
        { text: "Respond (Agree/Disagree)", preview: "üëç 'That's a good idea!' / 'I agree...'", color: "#9b59b6" },
        { text: "Ask others to speak", preview: "üó£Ô∏è 'What do you think?' / 'How about you?'", color: "#e67e22" },
        { text: "Move on to next point", preview: "‚û°Ô∏è 'Shall we move on to...?'", color: "#e74c3c" },
        { text: "Close the discussion", preview: "üèÅ 'To sum up...' / 'That's all.'", color: "#1abc9c" }
    ];
    
    let isDragInitialized = false;

    function initDragAndDrop() {
        const list = document.getElementById('draggable-list');
        list.innerHTML = '';
        
        let shuffled = [...correctStages].sort(() => Math.random() - 0.5);
        
        shuffled.forEach((item, index) => {
            const div = document.createElement('div');
            div.className = 'draggable-item';
            div.draggable = true;
            div.style.backgroundColor = item.color; // Set unique color
            div.style.border = "none";
            div.innerHTML = `<span>${item.text}</span> <span class='stem-preview'>${item.preview}</span>`;
            div.setAttribute('data-val', item.text);
            list.appendChild(div);
        });

        addDragEvents();
        isDragInitialized = true;
    }

    function addDragEvents() {
        const draggables = document.querySelectorAll('.draggable-item');
        const container = document.getElementById('draggable-list');

        draggables.forEach(draggable => {
            draggable.addEventListener('dragstart', () => {
                draggable.classList.add('dragging');
            });

            draggable.addEventListener('dragend', () => {
                draggable.classList.remove('dragging');
            });
        });

        container.addEventListener('dragover', e => {
            e.preventDefault();
            const afterElement = getDragAfterElement(container, e.clientY);
            const draggable = document.querySelector('.dragging');
            if (afterElement == null) {
                container.appendChild(draggable);
            } else {
                container.insertBefore(draggable, afterElement);
            }
        });
    }

    function getDragAfterElement(container, y) {
        const draggableElements = [...container.querySelectorAll('.draggable-item:not(.dragging)')];

        return draggableElements.reduce((closest, child) => {
            const box = child.getBoundingClientRect();
            const offset = y - box.top - box.height / 2;
            if (offset < 0 && offset > closest.offset) {
                return { offset: offset, element: child };
            } else {
                return closest;
            }
        }, { offset: Number.NEGATIVE_INFINITY }).element;
    }

    function checkOrder() {
        const items = document.querySelectorAll('.draggable-item');
        items.forEach((item, index) => {
            const val = item.getAttribute('data-val');
            
            if(val === correctStages[index].text) {
                item.style.border = "5px solid white";
                item.innerHTML += " ‚úÖ";
            } else {
                item.style.opacity = "0.5";
            }
        });
    }

    /* --- Spin Topic --- */
    function spinTopic() {
        const box = document.getElementById('random-topic-box');
        let counter = 0;
        const interval = setInterval(() => {
            box.innerText = randomTopics[counter % randomTopics.length].title;
            counter++;
            if(counter > 10) {
                clearInterval(interval);
                const finalObj = randomTopics[Math.floor(Math.random() * randomTopics.length)];
                
                let html = `<div style="font-size: 1.8rem; font-weight: bold; margin-bottom: 10px;">${finalObj.title}</div>`;
                html += `<div style="text-align: left; font-size: 1.2rem;">
                            Discuss:
                            <ul>
                                <li>${finalObj.points[0]}</li>
                                <li>${finalObj.points[1]}</li>
                                <li>${finalObj.points[2]}</li>
                            </ul>
                         </div>`;
                
                box.innerHTML = html;
                box.style.background = "#FFF59D";
            }
        }, 100);
    }

    /* --- Timer --- */
    function startSimpleTimer(seconds, elemId) {
        clearInterval(timerInterval);
        let timeLeft = seconds;
        const display = document.getElementById(elemId);
        
        display.style.color = "#0f0";

        timerInterval = setInterval(() => {
            timeLeft--;
            const m = Math.floor(timeLeft / 60);
            const s = timeLeft % 60;
            display.innerText = `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
            
            if (timeLeft <= 10) display.style.color = "red";

            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                display.innerText = "00:00";
                alert("Time is up!");
            }
        }, 1000);
    }

    /* --- Quiz Logic --- */
    function loadQuestion() {
        if(quizIndex >= quizQuestions.length) {
            document.getElementById('quiz-area').innerHTML = "<h2 style='font-size:3rem'>Quiz Complete! üåü</h2>";
            return;
        }
        const q = quizQuestions[quizIndex];
        document.getElementById('quiz-question').innerText = `Q${quizIndex+1}: ${q.q}`;
        const optionsDiv = document.getElementById('quiz-options');
        optionsDiv.innerHTML = "";
        
        q.options.forEach((opt, idx) => {
            const div = document.createElement('div');
            div.className = 'option-card';
            div.innerText = opt;
            div.onclick = () => checkQuizAnswer(div, idx === q.ans);
            optionsDiv.appendChild(div);
        });
        
        document.getElementById('quiz-feedback').innerText = "";
        document.getElementById('btn-next-q').style.display = "none";
    }

    function checkQuizAnswer(el, isCorrect) {
        const allOpts = document.getElementById('quiz-options').children;
        for(let opt of allOpts) {
            opt.onclick = null;
            opt.style.cursor = "default";
            opt.style.opacity = "0.6";
        }
        el.style.opacity = "1";

        if(isCorrect) {
            el.classList.add('correct');
            document.getElementById('quiz-feedback').innerText = "Correct! üéâ";
            document.getElementById('quiz-feedback').style.color = "var(--success)";
        } else {
            el.classList.add('incorrect');
            document.getElementById('quiz-feedback').innerText = "Oops! üòÖ";
            document.getElementById('quiz-feedback').style.color = "var(--danger)";
        }
        document.getElementById('btn-next-q').style.display = "inline-block";
    }

    function nextQuestion() {
        quizIndex++;
        loadQuestion();
    }

    /* --- Team Game Logic --- */
    function loadGameQuestion() {
        if (gameIndex >= gameQuestions.length) {
            // Auto finish triggered if questions run out, but can be manual
            endGame();
            return;
        }
        
        const q = gameQuestions[gameIndex];
        document.getElementById('game-prompt').innerText = `Team ${currentTurn}: ${q.text}`;
        
        // Reset Feedback
        document.getElementById('game-feedback').innerText = "";
        document.getElementById('game-feedback').className = "";
        
        // Update Options
        const optionDivs = document.querySelectorAll('.game-option');
        optionDivs.forEach((div, idx) => {
            div.innerText = q.options[idx];
            div.style.background = "white";
            div.style.cursor = "pointer";
            div.onclick = () => checkGameAnswer(idx);
        });
    }

    function updateCurrentTurn() {
        const selector = document.getElementById('team-selector');
        currentTurn = selector.value;
        // Refresh prompt
        if(gameIndex < gameQuestions.length) {
            const q = gameQuestions[gameIndex];
            document.getElementById('game-prompt').innerText = `Team ${currentTurn}: ${q.text}`;
        }
    }

    function checkGameAnswer(selectedIndex) {
        // Stop timer
        clearInterval(gameTimerInterval);

        const q = gameQuestions[gameIndex];
        const isCorrect = (selectedIndex === q.ans);
        const feedback = document.getElementById('game-feedback');
        
        if(isCorrect) {
            feedback.innerText = "Correct! +1 Point";
            feedback.style.color = "var(--success)";
            adjustScore(currentTurn, 1);
        } else {
            feedback.innerText = "Wrong!";
            feedback.style.color = "var(--danger)";
        }
        
        const optionDivs = document.querySelectorAll('.game-option');
        optionDivs.forEach(div => div.onclick = null);
    }

    function adjustScore(team, amount) {
        if(team === 'A') {
            scoreA += amount;
            document.getElementById('score-a').innerText = scoreA;
        } else {
            scoreB += amount;
            document.getElementById('score-b').innerText = scoreB;
        }
    }

    function nextGameRound() {
        gameIndex++;
        updateCurrentTurn(); // Sync with selector
        resetGameTimer(); // Start 15s timer for next round
        loadGameQuestion();
    }
    
    function resetGameTimer() {
        clearInterval(gameTimerInterval);
        let timeLeft = 15;
        const display = document.getElementById('game-timer');
        display.innerText = timeLeft + "s";
        display.style.color = "#d35400";
        
        gameTimerInterval = setInterval(() => {
            timeLeft--;
            display.innerText = timeLeft + "s";
            if(timeLeft <= 5) display.style.color = "red";
            if(timeLeft <= 0) {
                clearInterval(gameTimerInterval);
                display.innerText = "Time's Up!";
                // Disable options
                const optionDivs = document.querySelectorAll('.game-option');
                optionDivs.forEach(div => div.onclick = null);
            }
        }, 1000);
    }
    
    function resetGame() {
        gameIndex = 0;
        scoreA = 0;
        scoreB = 0;
        currentTurn = 'A';
        document.getElementById('score-a').innerText = "0";
        document.getElementById('score-b').innerText = "0";
        document.getElementById('game-area').innerHTML = `
            <h3 id="game-prompt" style="font-size: 2rem; margin-bottom: 30px;">Loading...</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div class="game-option" onclick="checkGameAnswer(0)">Option 1</div>
                <div class="game-option" onclick="checkGameAnswer(1)">Option 2</div>
            </div>
            <div id="game-feedback" style="margin-top: 20px; font-weight: bold; font-size: 1.5rem;"></div>
            
            <div style="margin-top: 20px;">
                <button class="btn btn-nav" onclick="nextGameRound()">Next Round ‚û°Ô∏è</button>
            </div>
            <div style="margin-top: 40px; border-top: 1px solid #ccc; padding-top: 20px;">
                <button class="btn btn-action" onclick="endGame()">üèÜ Finish Game</button>
                <button class="btn btn-nav" onclick="resetGame()" style="background:#95a5a6;">üîÑ Restart Game</button>
            </div>
        `;
        loadGameQuestion();
        resetGameTimer();
    }
    
    function endGame() {
        clearInterval(gameTimerInterval);
        const winner = scoreA > scoreB ? "Team A Wins!" : (scoreB > scoreA ? "Team B Wins!" : "It's a Tie!");
        
        // Add confetti
        for(let i=0; i<50; i++) {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            confetti.style.left = Math.random() * 100 + 'vw';
            confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
            confetti.style.backgroundColor = ['red', 'blue', 'green', 'yellow', 'purple'][Math.floor(Math.random()*5)];
            document.body.appendChild(confetti);
        }
        
        document.getElementById('game-area').innerHTML = `
            <div class="trophy-container">üèÜ</div>
            <h2 style="font-size: 3rem; color: var(--primary);">${winner}</h2>
            <p style="font-size: 1.5rem;">Final Score: A (${scoreA}) - B (${scoreB})</p>
            <div style="margin-top: 40px;">
                <button class="btn btn-nav" onclick="resetGame()" style="background:#95a5a6;">üîÑ Restart Game</button>
            </div>
        `;
    }

    // Initialize state
    document.getElementById('prev-btn').disabled = true;

</script>

</body>
</html>