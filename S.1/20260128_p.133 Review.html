<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Future Forms Review</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React & ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- Babel -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    /* Custom scrollbar for better aesthetics in modals */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: #f1f5f9;
    }

    ::-webkit-scrollbar-thumb {
      background: #cbd5e1;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #94a3b8;
    }
  </style>
</head>

<body class="bg-slate-100">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useRef, useEffect } = React;

    // --- Icons (Replaced lucide-react with inline SVGs for standalone) ---

    const IconBase = ({ size = 24, className = "", children }) => (
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width={size}
        height={size}
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
        className={className}
      >
        {children}
      </svg>
    );

    const MessageCircle = (props) => (
      <IconBase {...props}>
        <path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z" />
      </IconBase>
    );

    const BookOpen = (props) => (
      <IconBase {...props}>
        <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" />
        <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" />
      </IconBase>
    );

    const Check = (props) => (
      <IconBase {...props}>
        <polyline points="20 6 9 17 4 12" />
      </IconBase>
    );

    const X = (props) => (
      <IconBase {...props}>
        <line x1="18" y1="6" x2="6" y2="18" />
        <line x1="6" y1="6" x2="18" y2="18" />
      </IconBase>
    );

    const RefreshCcw = (props) => (
      <IconBase {...props}>
        <path d="M3 2v6h6" />
        <path d="M21 12A9 9 0 0 0 6 5.3L3 8" />
        <path d="M21 22v-6h-6" />
        <path d="M3 12a9 9 0 0 0 15 6.7l3-2.7" />
      </IconBase>
    );

    const ChevronRight = (props) => (
      <IconBase {...props}>
        <polyline points="9 18 15 12 9 6" />
      </IconBase>
    );

    const Book = (props) => (
      <IconBase {...props}>
        <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20" />
        <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z" />
      </IconBase>
    );

    const HelpCircle = (props) => (
      <IconBase {...props}>
        <circle cx="12" cy="12" r="10" />
        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" />
        <line x1="12" y1="17" x2="12.01" y2="17" />
      </IconBase>
    );

    // --- Sub-Components ---

    const ChatBubble = ({ item, answers, results, handleInputChange, checkAnswer, setActiveRule }) => {
      const isDawn = item.speaker === 'Dawn';
      const result = results[item.id];
      const isCorrect = result?.isCorrect;
      const isWrong = result && !isCorrect;

      return (
        <div className={`flex w-full mb-6 ${isDawn ? 'justify-end' : 'justify-start'}`}>
          <div className={`max-w-[90%] md:max-w-[75%] relative`}>
            {/* Avatar/Name */}
            <div className={`text-xs text-slate-400 mb-1 ${isDawn ? 'text-right' : 'text-left'}`}>
              {item.speaker}
            </div>

            {/* Bubble */}
            <div className={`p-4 rounded-2xl shadow-sm text-lg leading-relaxed
                            ${isDawn
                ? 'bg-blue-600 text-white rounded-tr-none'
                : 'bg-white text-slate-800 border border-slate-200 rounded-tl-none'
              }`}>

              <div className="flex flex-wrap items-center gap-2">
                <span>{item.parts[0]}</span>

                {/* Input Area */}
                {/* Added mr-8 to reserve space for the button so it doesn't overlap next word */}
                <div className="relative inline-flex flex-col group mr-8">
                  <input
                    type="text"
                    value={answers[item.id] || ""}
                    onChange={(e) => handleInputChange(item.id, e.target.value)}
                    placeholder={item.inputLabel}
                    className={`border-b-2 bg-transparent px-1 py-0 outline-none w-36 text-center transition-colors font-medium
                                            ${isDawn ? 'border-blue-300 placeholder-blue-300 focus:border-white' : 'border-slate-300 placeholder-slate-400 focus:border-blue-500'}
                                            ${isCorrect ? 'border-green-400 text-green-400' : ''}
                                            ${isWrong ? 'border-red-400 text-red-300' : ''}
                                        `}
                  />

                  {/* Check Button */}
                  {!isCorrect && answers[item.id] && (
                    <button
                      onClick={() => checkAnswer(item)}
                      className="absolute -right-8 top-1 z-10 bg-white/20 hover:bg-white/40 rounded-full p-1 transition-all"
                      title="Check Answer"
                    >
                      <ChevronRight size={16} className={isDawn ? "text-white" : "text-slate-600"} />
                    </button>
                  )}

                  {/* Status Icons */}
                  {isCorrect && <Check size={18} className="absolute -right-6 top-1 text-green-400" />}
                </div>

                <span>{item.parts[1]}</span>
              </div>

            </div>

            {/* Feedback & Actions Area */}
            {(isCorrect || isWrong) && (
              <div className={`mt-2 flex items-center gap-2 ${isDawn ? 'justify-end' : 'justify-start'}`}>
                <span className={`text-sm font-bold ${isCorrect ? 'text-green-600' : 'text-red-500'}`}>
                  {isCorrect ? "Great job!" : "Not quite."}
                </span>

                {/* Contextual Review Button */}
                <button
                  onClick={() => setActiveRule(item.ruleId)}
                  className="flex items-center gap-1 text-xs bg-amber-100 hover:bg-amber-200 text-amber-800 px-2 py-1 rounded-full transition-colors border border-amber-200"
                >
                  <BookOpen size={12} />
                  {isCorrect ? "Review Concept" : "Need Help?"}
                </button>
              </div>
            )}

          </div>
        </div>
      );
    };

    const RuleModal = ({ activeRule, showFullNotes, grammarNotes, setActiveRule, setShowFullNotes }) => {
      if (!activeRule && !showFullNotes) return null;

      // Determine content to show: specific rule or full library
      const content = showFullNotes
        ? Object.values(grammarNotes)
        : [grammarNotes[activeRule]];

      return (
        <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
          <div className="bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[80vh] flex flex-col overflow-hidden animate-in fade-in zoom-in duration-200">

            {/* Header */}
            <div className="p-4 border-b border-slate-100 flex justify-between items-center bg-slate-50">
              <h3 className="font-bold text-lg text-slate-800 flex items-center gap-2">
                <Book className="text-blue-600" size={20} />
                {showFullNotes ? "Grammar Reference Library" : "Grammar Concept Review"}
              </h3>
              <button
                onClick={() => { setActiveRule(null); setShowFullNotes(false); }}
                className="p-2 hover:bg-slate-200 rounded-full transition-colors"
              >
                <X size={20} className="text-slate-500" />
              </button>
            </div>

            {/* Body */}
            <div className="p-6 overflow-y-auto space-y-8">
              {content.map((note) => (
                <div key={note.id}>
                  <h2 className="text-xl font-bold text-slate-900 mb-3 border-b pb-2">{note.title}</h2>
                  {note.content}
                </div>
              ))}

              {/* Comparison Table (Only in full view or if relevant) */}
              {(showFullNotes || activeRule === 'simpleFuture' || activeRule === 'beGoingTo') && (
                <div className="mt-8 pt-6 border-t border-slate-200">
                  <h3 className="font-bold text-lg mb-4">Comparison: Will vs. Be Going To</h3>
                  <div className="overflow-x-auto">
                    <table className="w-full text-sm text-left border-collapse">
                      <thead>
                        <tr className="bg-slate-100 border-b border-slate-200">
                          <th className="p-3 font-semibold text-slate-700">Context</th>
                          <th className="p-3 font-semibold text-blue-700 w-1/3">Will</th>
                          <th className="p-3 font-semibold text-purple-700 w-1/3">Be Going To</th>
                        </tr>
                      </thead>
                      <tbody className="divide-y divide-slate-100">
                        <tr>
                          <td className="p-3 font-medium">Prediction</td>
                          <td className="p-3 text-slate-600">Based on opinion/belief.<br /><em>"I think it'll rain."</em></td>
                          <td className="p-3 text-slate-600">Based on current evidence.<br /><em>"Look! It's going to rain!"</em></td>
                        </tr>
                        <tr>
                          <td className="p-3 font-medium">Decision</td>
                          <td className="p-3 text-slate-600">Made <strong>now</strong> (spontaneous).<br /><em>"I'll do it later."</em></td>
                          <td className="p-3 text-slate-600">Made <strong>before</strong> (planned).<br /><em>"I'm going to do it later."</em></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              )}
            </div>

            {/* Footer */}
            <div className="p-4 border-t border-slate-100 bg-slate-50 text-center">
              <button
                onClick={() => { setActiveRule(null); setShowFullNotes(false); }}
                className="px-6 py-2 bg-slate-800 text-white rounded-lg hover:bg-slate-700 transition-colors font-medium"
              >
                Got it, thanks!
              </button>
            </div>
          </div>
        </div>
      );
    };

    const FutureFormsApp = () => {
      // --- Data & Content ---

      const grammarNotes = {
        simpleFuture: {
          id: 'simpleFuture',
          title: '1. The Simple Future (will, shall)',
          content: (
            <div className="space-y-4 text-slate-700">
              <div className="bg-blue-50 p-4 rounded-lg border-l-4 border-blue-500">
                <h4 className="font-bold text-blue-800">1.1 Usage</h4>
                <ul className="list-disc ml-5 mt-2 space-y-1">
                  <li><strong>Predictions:</strong> What we think is likely to happen. <br /><em className="text-slate-500">"I think the weather will be hot."</em></li>
                  <li><strong>Instant Decisions:</strong> Made at the time of speaking. <br /><em className="text-slate-500">"No bread? I'll buy some."</em></li>
                </ul>
              </div>
              <div className="bg-white p-4 rounded-lg border border-slate-200 shadow-sm">
                <h4 className="font-bold text-slate-800">1.2 Form</h4>
                <p className="mt-1"><strong>will</strong> + base verb</p>
                <div className="mt-2 text-sm bg-slate-100 p-2 rounded">
                  <p>Positive: I will ('ll) be late.</p>
                  <p>Negative: I will not (won't) arrive.</p>
                </div>
              </div>
              <div className="bg-white p-4 rounded-lg border border-slate-200 shadow-sm">
                <h4 className="font-bold text-slate-800">1.4 Shall</h4>
                <p className="mt-1">Mostly used for <strong>offers</strong> or <strong>suggestions</strong> with "I" and "We".</p>
                <p className="italic text-slate-500 mt-1">"Shall I bring some drinks?"</p>
              </div>
            </div>
          )
        },
        beGoingTo: {
          id: 'beGoingTo',
          title: '2. Be going to',
          content: (
            <div className="space-y-4 text-slate-700">
              <div className="bg-purple-50 p-4 rounded-lg border-l-4 border-purple-500">
                <h4 className="font-bold text-purple-800">2.1 Usage</h4>
                <ul className="list-disc ml-5 mt-2 space-y-1">
                  <li><strong>Evidence-based Prediction:</strong> Something is about to happen based on what we see. <br /><em className="text-slate-500">"Look at the clouds! It's going to rain."</em></li>
                  <li><strong>Prior Plans:</strong> Decisions made <em>before</em> speaking. <br /><em className="text-slate-500">"I'm going to call Wendy later."</em></li>
                </ul>
              </div>
              <div className="bg-white p-4 rounded-lg border border-slate-200 shadow-sm">
                <h4 className="font-bold text-slate-800">Structure</h4>
                <p className="mt-1"><strong>am/is/are</strong> + <strong>going to</strong> + verb</p>
              </div>
            </div>
          )
        },
        presentForms: {
          id: 'presentForms',
          title: '3. Simple Present & Present Continuous',
          content: (
            <div className="space-y-4 text-slate-700">
              <div className="bg-green-50 p-4 rounded-lg border-l-4 border-green-500">
                <h4 className="font-bold text-green-800">3.1 Simple Present (Timetables)</h4>
                <p className="mt-1">Used for fixed events, schedules, or programmes (often with times/dates).</p>
                <ul className="list-disc ml-5 mt-2 space-y-1 text-sm">
                  <li><em>"The film <strong>starts</strong> at six."</em></li>
                  <li><em>"The ferry <strong>leaves</strong> at two."</em></li>
                </ul>
              </div>
              <div className="bg-orange-50 p-4 rounded-lg border-l-4 border-orange-500">
                <h4 className="font-bold text-orange-800">3.2 Present Continuous (Arrangements)</h4>
                <p className="mt-1">Used for definite plans and personal arrangements in the near future.</p>
                <ul className="list-disc ml-5 mt-2 space-y-1 text-sm">
                  <li><em>"I <strong>am playing</strong> badminton tomorrow."</em></li>
                  <li><em>"We <strong>are visiting</strong> Ocean Park."</em></li>
                </ul>
              </div>
              <div className="mt-4 p-3 bg-slate-100 rounded text-sm italic">
                <strong>Note:</strong> We cannot use Present Continuous for predictions (weather, accidents), only for human plans.
              </div>
            </div>
          )
        }
      };

      const exerciseData = [
        {
          id: 1,
          speaker: 'Dawn',
          type: 'question',
          parts: ["What", "this weekend, Alex?"],
          inputLabel: "(1) do",
          correct: ["are you doing"],
          ruleId: 'presentForms',
          hint: "Use Present Continuous for personal plans."
        },
        {
          id: 2,
          speaker: 'Alex',
          type: 'answer',
          parts: ["I", "to Macao on Saturday with my brother Ben."],
          inputLabel: "(2) go",
          correct: ["am going", "'m going"],
          ruleId: 'presentForms',
          hint: "Use Present Continuous for a definite plan."
        },
        {
          id: 3,
          speaker: 'Dawn',
          type: 'question',
          parts: ["", "in the morning or in the afternoon?"],
          inputLabel: "(3) go",
          correct: ["are you going"],
          ruleId: 'presentForms',
          hint: "Question form of Present Continuous."
        },
        {
          id: 4,
          speaker: 'Alex',
          type: 'answer',
          parts: ["Well, I", "a karate lesson at ten o'clock,"],
          inputLabel: "(4) have",
          correct: ["am having", "'m having", "have"],
          ruleId: 'presentForms',
          hint: "Fixed arrangement (Continuous) or Schedule (Simple)."
        },
        {
          id: 5,
          speaker: 'Alex',
          type: 'answer',
          parts: ["...so I", "a ferry after that."],
          inputLabel: "(5) get",
          correct: ["am getting", "'m getting"],
          ruleId: 'presentForms',
          hint: "Personal arrangement."
        },
        {
          id: 6,
          speaker: 'Dawn',
          type: 'question',
          parts: ["What time", "?"],
          inputLabel: "(6) leave",
          correct: ["does it leave"],
          ruleId: 'presentForms',
          hint: "Asking about a timetable/schedule (Simple Present)."
        },
        {
          id: 7,
          speaker: 'Alex',
          type: 'answer',
          parts: ["At one o'clock. It", "in Macao at about two."],
          inputLabel: "(7) arrive",
          correct: ["arrives"],
          ruleId: 'presentForms',
          hint: "Timetable/Schedule event."
        },
        {
          id: 8,
          speaker: 'Dawn',
          type: 'question',
          parts: ["Where", "?"],
          inputLabel: "(8) stay",
          correct: ["are you staying"],
          ruleId: 'presentForms',
          hint: "Question about personal plans."
        },
        {
          id: 9,
          speaker: 'Alex',
          type: 'answer',
          parts: ["I don't know yet. Ben", "a hotel later today."],
          inputLabel: "(9) book",
          correct: ["is booking"],
          ruleId: 'presentForms',
          hint: "Action planned for the near future."
        },
        {
          id: 10,
          speaker: 'Dawn',
          type: 'question',
          parts: ["", "to Blackpink's concert in Macao?"],
          inputLabel: "(10) go",
          correct: ["are you going"],
          ruleId: 'presentForms',
          hint: "Question about plans."
        },
        {
          id: 11,
          speaker: 'Alex',
          type: 'answer',
          parts: ["Yes, we are. It", "at eight o'clock..."],
          inputLabel: "(11) start",
          correct: ["starts"],
          ruleId: 'presentForms',
          hint: "Official programme/schedule."
        },
        {
          id: 12,
          speaker: 'Alex',
          type: 'answer',
          parts: ["...and", "at ten o'clock..."],
          inputLabel: "(12) end",
          correct: ["ends"],
          ruleId: 'presentForms',
          hint: "Official programme/schedule."
        },
        {
          id: 13,
          speaker: 'Alex',
          type: 'answer',
          parts: ["...so we", "dinner first."],
          inputLabel: "(13) have",
          correct: ["are having", "'re having"],
          ruleId: 'presentForms',
          hint: "Personal arrangement."
        },
        {
          id: 14,
          speaker: 'Dawn',
          type: 'question',
          parts: ["So", "to Hong Kong on Sunday?"],
          inputLabel: "(14) return",
          correct: ["are you returning"],
          ruleId: 'presentForms',
          hint: "Question about arrangements."
        },
        {
          id: 15,
          speaker: 'Alex',
          type: 'answer',
          parts: ["Yes, we are. Our ferry", "at two o'clock."],
          inputLabel: "(15) leave",
          correct: ["leaves"],
          ruleId: 'presentForms',
          hint: "Timetable schedule."
        },
        {
          id: 16,
          speaker: 'Alex',
          type: 'answer',
          parts: ["Oh, I just remembered we", "an English test on Monday according to the class schedule."],
          inputLabel: "(16) have",
          correct: ["have"],
          ruleId: 'presentForms',
          hint: "Class schedule (Fixed event)."
        },
        {
          id: 17,
          speaker: 'Dawn',
          type: 'question',
          parts: ["OK. My piano lesson", "at four o'clock. I can meet you at four thirty."],
          inputLabel: "(17) end",
          correct: ["ends"],
          ruleId: 'presentForms',
          hint: "Fixed schedule."
        }
      ];

      // --- State ---
      const [answers, setAnswers] = useState({});
      const [results, setResults] = useState({});
      const [activeRule, setActiveRule] = useState(null);
      const [showFullNotes, setShowFullNotes] = useState(false);
      const scrollRef = useRef(null);

      // --- Actions ---

      const handleInputChange = (id, value) => {
        setAnswers(prev => ({ ...prev, [id]: value }));
        // Clear result state when user types to encourage retry
        if (results[id]) {
          setResults(prev => {
            const newResults = { ...prev };
            delete newResults[id];
            return newResults;
          });
        }
      };

      const checkAnswer = (item) => {
        const userVal = (answers[item.id] || "").trim().toLowerCase();
        // Check if user input matches any of the correct variations
        const isCorrect = item.correct.some(opt => opt.toLowerCase() === userVal);

        setResults(prev => ({
          ...prev,
          [item.id]: {
            isCorrect,
            message: isCorrect ? "Correct!" : "Try again",
            actual: userVal
          }
        }));
      };

      const resetAll = () => {
        setAnswers({});
        setResults({});
        window.scrollTo({ top: 0, behavior: 'smooth' });
      };

      return (
        <div className="min-h-screen bg-slate-100 font-sans text-slate-900">

          {/* Navbar */}
          <header className="bg-white shadow-sm sticky top-0 z-10">
            <div className="max-w-3xl mx-auto px-4 py-4 flex justify-between items-center">
              <div className="flex items-center gap-2">
                <div className="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center text-white font-bold">
                  <MessageCircle size={18} />
                </div>
                <h1 className="font-bold text-xl text-slate-800 hidden sm:block">Future Forms Review</h1>
                <h1 className="font-bold text-xl text-slate-800 sm:hidden">Review</h1>
              </div>

              <div className="flex gap-2">
                <button
                  onClick={() => setShowFullNotes(true)}
                  className="flex items-center gap-2 px-3 py-2 text-sm font-medium text-slate-600 hover:bg-slate-100 rounded-lg transition-colors"
                >
                  <Book size={18} />
                  <span className="hidden sm:inline">Grammar Notes</span>
                </button>
                <button
                  onClick={resetAll}
                  className="flex items-center gap-2 px-3 py-2 text-sm font-medium text-red-600 hover:bg-red-50 rounded-lg transition-colors"
                >
                  <RefreshCcw size={18} />
                  <span className="hidden sm:inline">Reset</span>
                </button>
              </div>
            </div>
          </header>

          {/* Main Content Area */}
          <main className="max-w-3xl mx-auto px-4 py-8 pb-32">

            {/* Intro Card */}
            <div className="bg-white rounded-xl p-6 shadow-sm mb-8 border border-slate-200">
              <h2 className="text-lg font-bold mb-2">Exercise 5: Weekend Plans</h2>
              <p className="text-slate-600 mb-4">
                Dawn is asking Alex about his weekend plans. Complete their conversation using the correct
                <strong className="text-blue-600"> Present Continuous</strong> or <strong className="text-orange-600">Simple Present</strong> forms.
              </p>
              <div className="flex items-center gap-2 text-sm text-slate-500 bg-slate-50 p-2 rounded border border-slate-200">
                <HelpCircle size={16} />
                <span>Type the verb in the correct form and click the arrow to check.</span>
              </div>
            </div>

            {/* Chat Stream */}
            <div ref={scrollRef} className="space-y-2">
              {exerciseData.map((item) => (
                <ChatBubble
                  key={item.id}
                  item={item}
                  answers={answers}
                  results={results}
                  handleInputChange={handleInputChange}
                  checkAnswer={checkAnswer}
                  setActiveRule={setActiveRule}
                />
              ))}
            </div>

          </main>

          {/* Modals */}
          <RuleModal
            activeRule={activeRule}
            showFullNotes={showFullNotes}
            grammarNotes={grammarNotes}
            setActiveRule={setActiveRule}
            setShowFullNotes={setShowFullNotes}
          />

        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<FutureFormsApp />);
  </script>
</body>

</html>